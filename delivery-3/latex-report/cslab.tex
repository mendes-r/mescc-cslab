\documentclass[11pt]{article}

\usepackage[a4paper,
            bindingoffset=0.5cm,
            left=3cm,
            right=3cm,
            top=3cm,
            bottom=4cm,
            footskip=1.5cm]{geometry}
            
%
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{blindtext}
\usepackage{float}
\usepackage{xcolor}
\usepackage{multirow}
\usepackage{minted}
 \usepackage{url}
 \usepackage{amsmath}
%

\setcounter{secnumdepth}{3}

%%%%%%%%%%%%%%%%%%%%%
\title{\textbf{Critical Systems Lab - MESCC\\ Water Pumping Automated System}}
\date{ISEP, January 2024, \textbf{Third Delivery}}
\author{Ricardo Mendes\\ 1201779
\and Arthur Gerbelli\\ 1220201}
%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\maketitle              
\newpage
\tableofcontents
\newpage

%
\section{Introduction}

This is the last report that will summarize all the analysis and implementation of the final work.

We tried to focus on the conclusions and not bring back all the specificities of the previews analyses. 

Although the following chapter are tightly defined, the report should be read as an whole. 

%%%
\section{Requirement Specifications}

- ligar uma bomba de modo aleatorio de modo a nao corruer apenas uma.
- lista do que foi implementado

%%%
\subsection{System Requirements}

%%%
\subsection{System Structure and Traceability}


\newpage
%%%
\section{Implementation}

%%%
\subsection{CCSYA - Assembly}

- mostrar codigo da implementacao
- um dos comentarios no codigo de assembly está mal (beq)

%%%
\subsection{RTAES - Concorrency and Real Time Scheduling}

%%%
\subsubsection{Real Time Scheduling}

\begin{table}[!htb]
    \caption{Theoretical values (left) and implemented values (right) in \textit{ms}:}
    \begin{minipage}{0.75\linewidth}
		\begin{table}[H]
		\begin{tabular}{lll}
		\textbf{Task} & \textbf{Ci} & \textbf{Ti} \\
		\textbf{1}    & 60         & 100           \\
		\textbf{2}    & 25         & 200           \\
		\textbf{3}    & 35         & 250          
		\end{tabular}
		\end{table}

    \end{minipage}%
    \begin{minipage}{.5\linewidth}
		\begin{table}[H]
		\begin{tabular}{lll}
		\textbf{Task} & \textbf{Ci} & \textbf{Ti} \\
		\textbf{1}    & 1200         & 2000           \\
		\textbf{2}    & 500         & 4000           \\
		\textbf{3}    & 700         & 5000          
		\end{tabular}
		\end{table}

    \end{minipage} 
\end{table}

The values on the right side table were found by running the code in different situations.

\begin{minted}{c}
for (;;) {
    unsigned long start_time = millis();
    unsigned long finish_time;
    unsigned long duration;

    // Code -------------------

    finish_time = millis();      
    duration = finish_time - start_time;
    Serial.print("TASK N - Execution Time[ms]: ");
    Serial.println(duration); 
}
\end{minted}

\begin{minted}{bash}
TASK 3 - Duration[ms]: 40
TASK 1 - Duration[ms]: 917
TASK 2 - Duration[ms]: 1
TASK 1 - Duration[ms]: 658
TASK 1 - Duration[ms]: 754
TASK 3 - Duration[ms]: 770
TASK 2 - Duration[ms]: 0
TASK 1 - Duration[ms]: 649
TASK 1 - Duration[ms]: 799
TASK 3 - Duration[ms]: 29
TASK 2 - Duration[ms]: 0
TASK 1 - Duration[ms]: 176
TASK 1 - Duration[ms]: 997
TASK 2 - Duration[ms]: 0
TASK 1 - Duration[ms]: 187
TASK 3 - Duration[ms]: 157
TASK 1 - Duration[ms]: 990
TASK 2 - Duration[ms]: 1
TASK 1 - Duration[ms]: 1036
\end{minted}

\begin{minted}{c}
long next_release = 5000 - duration;
if (next_release > 0) {
  vTaskDelay(next_release / portTICK_PERIOD_MS);
} else {
  Serial.println("TRASK 3 - FAILED Deadline !!!");
}
\end{minted}

\begin{minted}{bash}
TASK 1 - Connection failed: 172.20.10.13
TASK 1 - Connection failed: 172.20.10.5
TASK 1 - Duration[ms]: 2009
TASK 1 - FAILED Deadline !!!
\end{minted}


connection timeout = 1s
that gives a lot of timeouts. specially with one of the sensors
mitigation.

%%%
\subsubsection{Concorrency}

- mostrar codigo da implementacao

- onde mutex

%%%
\subsection{COMCS - Communication}

- TCP pull strategy

- Arthur

%%%
\subsection{Prototype}

\subsubsection{Overview}

- diagram if implementation

\subsubsection{WPS}

- explicar a tabela dos inputs dos sensores e levantar alarm caso (A tabela agora é diferente da ultima vez)
- strategy for cluster of control unit nodes

- dois timeouts dos sensores equivale a max level.... nao devia estar assim

\subsubsection{MQTT Broker}

- one topic per WPS

\subsubsection{RSS}

- reads broker every 1 sec
- sends alert after 15 sec without message
- subscribes to each WPS topics (iter)
- log who clicked the button and maintain LED on... because the system heals it self 

\subsubsection{Web Server}

%%%
\section{Team Work}


%%%%%%%%%%%%%%%%%%%%%
\newpage
\begin{thebibliography}{8}

\bibitem{c1}
 Espressif documentation: {\url{https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/freertos_idf.html#id23/}}

\end{thebibliography}

\end{document}
